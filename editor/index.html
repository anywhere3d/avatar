<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="{{description}}">
    <link rel="manifest" href="/manifest.json">
    <title>Avatar Editor</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/side-panels.css">
    <link rel="stylesheet" href="/css/messg.css" >
    <link rel="stylesheet" href="/css/spectrum.css">
    <link rel="stylesheet" href="/css/colorpicker.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/panel-ui.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/joystick.css">
    <link rel="stylesheet" href="/css/uppy.css">

    <script src="/js/w3.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/jquery.lazy.js"></script>
    <script src="/js/jquery.lazy.plugins.js"></script>
    <script>
        debugMode = true;
    </script>

</head>

<body>

<style>
    .navbar-nav > li > a.menu-item,
    .navbar-nav > li > div > a.menu-item {font-weight:normal;}
    .navbar-nav > li > a.menu-item:hover,
    .navbar-nav > li > div > a.menu-item:hover {color:aquamarine;}
    .navbar-nav > li > div > a.menu-item { text-decoration:none }
    #nav-btn-login { margin-left:10px; }
    #nav-btn-login > a { color:#fff; font-weight:bold; font-size:14px; text-decoration:none; }
    #nav-btn-snapshot > a { color:#38c0ee; }
</style>

<nav class="navbar navbar-default navbar-fixed-top">

    <div class="container">

        <div class="navbar-header">
            <div class="navbar-brand">
                <a href="https://anywhere3d.org" class="navbar-caption" title="anywhere3d.com">anywhere3d</a>
            </div>
            <a class="navbar-logo pull-left"><img src="https://i.imgur.com/09bC4Q0.png" alt="anywhere3d logo"></a>
            <ul class="nav navbar-nav navbar-right pull-left">
                
                <li class="first"></li>

                <li id="nav-item-over" style="display:none;"><a class="first menu-item">Overview</a></li>
                <li id="nav-item-home" style="display:none;"><a class="menu-item">Home</a></li>
                <li id="nav-item-dash" style="display:none;"><a class="menu-item">Dashboard</a></li>
                <li id="nav-item-exam" style="display:none;"><a class="menu-item">Examples</a></li>

            </ul>
        </div>

        <ul class="nav navbar-nav navbar-right">

            <li class="pull-right">
                <div class="navbar-btn btn btn-primary btn-white-outline" id="nav-btn-login" style="display:none;">
                    <a class="menu-item">Login</a>
                </div>
            </li>

        </ul>

    </div>

</nav>


<style>
    body { margin:0px; height:100vh; overflow:hidden; font-family: Arial, sans-serif; }
    canvas { display:block !important; }
    #body-section { 
        height:100%; padding-top:0px; padding-bottom:0px; 
        background-color:rgba(0,0,0,1); overflow:hidden; 
    }
    #render-container { 
        width:100%; height:100%; 
        opacity:1; background-color:rgb(0,0,0); 
    }
    #splash-holder,
    #auth-holder { 
        position:absolute; left:0px; top:0px; width:100%; height:100%;
        text-align:center; background-color:rgba(255,255,255,0); z-index:1; 
    }
    .twitter-holder { text-align:center; margin:10px 0px; }    
    .patreon-holder { display:none; text-align:center; }
    #joystick1, #joystick2, #jumpButton  { z-index:0 !important; }
    .menu-helpers a,
    .editor-helpers a,
    .mode-helpers a,
    .updater-helpers a,
    .helpers a { font:bold 16px Arial; cursor:pointer; text-decoration:none; }
    .mode-helper a { color:fuchsia; }
    .ui-dialog { opacity:1 !important; }
    .non-ready { display:none; }
    .updater   { cursor:pointer; }
</style>


<section class="mbr-section mbr-after-navbar" id="body-section">

    <div id="render-container" class="mbr-overlay"></div>

    <div class="side-panel" id="left-side">
        <div id="left-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="left-side-content">

            <div id="avatar-editor-left-panel">

                <div id="chatboard-holder">
                    <li id="chatboard" class="menu-helpers"><a>Open Chatboard</a></li>
                </div>

            </div>
            
            <div id="display-helpers-holder">
                <li id="display-helpers" class="menu-helpers"><a>Display Helpers</a></li>
            </div>

            <div class="twitter-holder">
                <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-url="http://anywhere3d.com" data-lang="en" data-show-count="false">Tweet</a>
                <a href="https://twitter.com/anywhere3d?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-screen-name="false" data-lang="en" data-show-count="false">Follow</a>
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>

            <div class="patreon-holder"></div>

        </div>

    </div>

    <div class="side-panel" id="right-side">
        <div id="right-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="right-side-content">

            <div id="actions-holder">
                <li id="action-controls" class="menu-helpers"><a>Action Controls</a></li>
            </div>

            <div id="menu-holder">
                <h4>Menu:</h4>
                <li id="avatar-editor" class="editor-helpers"><a>Avatar Editor</a></li>
                <li id="outfit-editor" class="editor-helpers"><a>Outfit Editor</a></li>
                <li id="scene-editor" class="editor-helpers"><a>Scene Editor</a></li>
                <li id="animator-editor" class="editor-helpers"><a>Animator</a></li>
            </div>

            <div id="editor-holder"></div>

            <div id="avatar-editor-holder"></div>
            <div id="outfit-editor-holder"></div>
            <div id="scene-editor-holder"></div>
            <div id="animator-editor-holder"></div>

            <div id="snapshot-holder">
                <li id="take-snapshot" class="menu-helpers"><a>Snapshots</a></li>
            </div>

            <div id="scene-window-holder"></div>
            <div id="outfit-saver-holder"></div>
            <div id="water-editor-holder"></div>

            <div id="updaters-holder"></div>

        </div>
    </div>

</section>

<script src="/js/localforage.js"></script>

<script async src="/js/alerts.js"></script>
<script async src="/js/rawinflate.js"></script>
<script async src="/js/rawdeflate.js"></script>
<script async src="/js/bootbox.min.js"></script>
<script async src="/js/bootstrap.min.js"></script>
<script async src="/js/DeviceDetector.js"></script>
<script async src="/js/spectrum.js"></script>
<script async src="/js/SidePanels.js"></script>

<script src="/three/three.js"></script>
<script src="/three/EditorControls.js"></script>
<script src="/three/Detector.js"></script>
<script src="/three/Projector.js"></script>
<script src="/three/Animation.js"></script>
<script src="/three/AnimationHandler.js"></script>
<script src="/three/KeyFrameAnimation.js"></script>

<script>

//  editor-scene.js
    var debugMode;

    var fontFolder = "/three/fonts/";
    var fontPath = fontFolder + "helvetiker_regular.typeface.json";
    var sceneContainerSelector = "#render-container";
    var container = $(sceneContainerSelector)[0];

    var scene, 
        camera, 
        renderer, 
        controls;

    var sceneLights, 
        axisCustomHelper, 
        axisOriginHelper;

    var projector, 
        keyboard, 
        clock;

    var scenename = "Webspaces";

    scene = new THREE.Scene();
    scene.name = scenename;

    camera = new FpsCamera(50, 1, 10000);
    camera.position.set(0, 20, 100);
    controls = new THREE.EditorControls(camera);

    scene.add(directionalLight(0xffffff,  1000, 1000,  1000, 0.5));
    scene.add(directionalLight(0xffffff,  1000, 1000, -1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000,  1000, 0.5)); 
    scene.add(directionalLight(0xffffff, -1000, 1000, -1000, 0.5));
    scene.add(directionalLight(0xffffff,     0,-5000,     0, 0.3));

    groundHelper = new GroundHelper(500, 10);  
    axisCustomHelper = new CustomAxisHelper(1200);
    axisOriginHelper = new OriginAxisHelper(500);

    projector = new THREE.Projector();
//  keyboard = new KeyboardState();
    clock = new THREE.Clock();

    renderer = new THREE.WebGLRenderer({
        antialias: true,
        preserveDrawingBuffer: true,
    });

    renderer.shadowMap.enabled = true;
    renderer.setPixelRatio( window.devicePixelRatio );
//  renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setSize( container.clientWidth, container.clientHeight );
    container.appendChild( renderer.domElement );

    sceneBackground( "/skyboxes/space4/" );

    function sceneBackground( path ){
        if (!!scene && Number(THREE.REVISION) >= 78) {
    
            skyboxfolder = path;
            var loader = new THREE.CubeTextureLoader();
            var urls = [
                "https://i.imgur.com/v6bjQLb.jpg", // "posx.jpg",
                "https://i.imgur.com/lwrlr6P.jpg", // "negx.jpg", 
                "https://i.imgur.com/kKUKBJg.jpg", // "posy.jpg", 
                "https://i.imgur.com/N0oZlJR.jpg", // "negy.jpg", 
                "https://i.imgur.com/x9q8z0K.jpg", // "posz.jpg", 
                "https://i.imgur.com/HYcK7Ii.jpg", // "negz.jpg"
            ];
            loader.load( urls, function(texture){
            //  debugMode && console.log("cube texture loaded:", url);
                scene.background = texture;
                scene.background.needsUpdate = true;
            });
        }
    }

// SceneHelpers.js

    function toggleHelperVisible(theHelper){
        theHelper.visible = !theHelper.visible;
    }

    function directionalLight(hexcolor, x, y, z, intensity){
        var light = new THREE.DirectionalLight( hexcolor );
        light.position.set( x, y, z );
        light.intensity = intensity;
        return light;
    }
    
    function convertingFromBufferGeometry( object ){
        debugMode && console.log("converting from buffer geometry:", object);
        if( object.children ) {
            for( child in object.children ) {
                var t = Date.now();
                object.children[child].geometry = new THREE.Geometry().fromBufferGeometry( object.children[child].geometry );
    		    debugMode && console.log(child, object.children[child].name, "time:", Date.now() - t, "msec.");
            }
        }
    }

    function FpsCamera(fov, near, far){
        var camera = new THREE.PerspectiveCamera( fov, window.innerWidth / window.innerHeight, near, far );
        camera.position.set( 0, 11, -113 );
        camera.rotation.set( 0, 0, 0 );
        camera.name = "FPS_CAMERA" ;
        return camera;
    }
    
    function FpsCameraControls( camera ){
        var controls = new THREE.FirstPersonControls( camera );
        controls.movementSpeed = 30;
        controls.lookSpeed = 0.05;
        controls.noFly = true;
        controls.autoForward = false;
        controls.lookVertical = false;
        controls.enabled = true;
        return controls;
    }
    
    function DirectionalLight(hexcolor, x, y, z, intensity){
        var light = new THREE.DirectionalLight( hexcolor );
        light.position.set( x, y, z );
        light.intensity = intensity;
        scene.add( light );
        return light;
    }
    
    function DirectionalLightsGroup(hexcolor, x, y, z, intensity){
        var group = new THREE.Group();
        scene.add(group);
        light0 = new directionalLight(hexcolor, x, y, z, intensity);
        light1 = new directionalLight(hexcolor, x, y, -z, intensity);
        light2 = new directionalLight(hexcolor, -x, y, -z, intensity);
        light3 = new directionalLight(hexcolor, -x, y, z, intensity);
        light4 = new directionalLight(hexcolor, 0, -y, 0, intensity);
        group.add( light0, light1, light2, light3, light4 );
        return [light0, light1, light2, light3, light4];
    }
    
    function GroundHelper(xz, step){
        if (!xz) xz = 1000;
        if (!step) step = 10;
        var grid = new THREE.GridHelper( xz, step, 0x444444, 0x444444 );
        grid.name = "GRID"
        grid.position.y = 0;
        scene.add( grid );
        return grid;
    }
    
    function SkeletonHelper(target){
        var helper = new THREE.SkeletonHelper(target);
        helper.material.linewidth = 5;
        helper.name = "ARMATURE_HELPER";
        helper.visible = true;
        return helper;
    }
    
    function Skybox( cubemap ) {
        scene.background = new THREE.CubeTexture( cubemap );
        scene.background.needsUpdate = true;
    }
    
    function Skydome( path ){
        var loader = new THREE.TextureLoader();
        var skydomeGmt = new THREE.SphereGeometry( 2000, 64, 32 );
        var skydomeTxr = loader.load( path );
        var skydomeMtl = new THREE.MeshBasicMaterial({
            map: skydomeTxr,
            side: THREE.DoubleSide
        });
        var skydome = new THREE.Mesh( skydomeGmt, skydomeMtl );
        skydome.scale.y = 0.5;
        skydome.name = "SKYDOME";
        scene.add(skydome);
        return skydome;
    }
    
    function CustomAxisHelper( distance ){
        var group = new THREE.Group();
        scene.add(group);
    
    //  Lines.
        var geometryAxisXpos = new THREE.Geometry();
        var geometryAxisXneg = new THREE.Geometry();
        var geometryAxisYpos = new THREE.Geometry();
        var geometryAxisYneg = new THREE.Geometry();
        var geometryAxisZpos = new THREE.Geometry();
        var geometryAxisZneg = new THREE.Geometry();
    
        var materialAxisXpos = new THREE.LineBasicMaterial( {color: 0xff0000} );
        var materialAxisXneg = new THREE.LineBasicMaterial( {color: 0xff0000} );
        var materialAxisYpos = new THREE.LineBasicMaterial( {color: 0x00ff00} );
        var materialAxisYneg = new THREE.LineBasicMaterial( {color: 0x00ff00} );
        var materialAxisZpos = new THREE.LineBasicMaterial( {color: 0x0000ff} );
        var materialAxisZneg = new THREE.LineBasicMaterial( {color: 0x0000ff} );
    
        geometryAxisXpos.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( distance, 0, 0 ) );
        geometryAxisXneg.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3(-distance, 0, 0 ) );
        geometryAxisYpos.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, distance, 0 ) );
        geometryAxisYneg.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0,-distance, 0 ) );
        geometryAxisZpos.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 0, distance ) );
        geometryAxisZneg.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 0,-distance ) );
    
        var lineAxisXpos = new THREE.Line( geometryAxisXpos, materialAxisXpos );
        var lineAxisXneg = new THREE.Line( geometryAxisXneg, materialAxisXneg );
        var lineAxisYpos = new THREE.Line( geometryAxisYpos, materialAxisYpos );
        var lineAxisYneg = new THREE.Line( geometryAxisYneg, materialAxisYneg );
        var lineAxisZpos = new THREE.Line( geometryAxisZpos, materialAxisZpos );
        var lineAxisZneg = new THREE.Line( geometryAxisZneg, materialAxisZneg );
    
        group.add( lineAxisXpos );
        group.add( lineAxisXneg );
    //  group.add( lineAxisYpos );
    //  group.add( lineAxisYneg );
        group.add( lineAxisZpos );
        group.add( lineAxisZneg );
        group.name = "AXES"
        return group;
    }
    
    
    function OriginAxisHelper( distance ){
        var group = new THREE.Group();
        var promise = new Promise( function(resolve, reject){
            var loader = new THREE.FontLoader();
            loader.load( fontPath, function ( response ) {
                var font = response;
                scene.add(group);
    
            //  Font Material
                var materialFace = new THREE.MeshBasicMaterial( { color: 0xffffff } );
                var materialSide = new THREE.MeshBasicMaterial( { color: 0x888888 } );
                var materialArray = [ materialFace, materialSide ];
                var material = new THREE.MeshFaceMaterial(materialArray);
    
            //  Text Styles.
            h0 = { size: 40, height: 2,   curveSegments: 10, font: font, weight: "normal", style: "normal", bevelThickness: 1, bevelSize: 2, bevelEnabled: false, material: 0, extrudeMaterial: 1 }
            h1 = { size: 20, height: 1,   curveSegments: 10, font: font, weight: "normal", style: "normal", bevelThickness: 1, bevelSize: 2, bevelEnabled: false, material: 0, extrudeMaterial: 1 }
            h2 = { size: 10, height: 1,   curveSegments: 10, font: font, weight: "normal", style: "normal", bevelThickness: 1, bevelSize: 2, bevelEnabled: false, material: 0, extrudeMaterial: 1 }
            h3 = { size: 5,  height: 0.5, curveSegments: 10, font: font, weight: "normal", style: "normal", bevelThickness: 1, bevelSize: 2, bevelEnabled: false, material: 0, extrudeMaterial: 1 }
    
            //  Origins Group.
                group.add( new Text3D( "+x", h1, [2, 2, 5], [ distance, 20, 0], [0, -Math.PI * 0.5, 0]) );
                group.add( new Text3D( "-x", h1, [2, 2, 5], [-distance, 20, 0], [0,  Math.PI * 0.5, 0]) ); 
                group.add( new Text3D( "+z", h1, [2, 2, 5], [0, 20,  distance], [0, -Math.PI,       0]) ); 
                group.add( new Text3D( "-z", h1, [2, 2, 5], [0, 20, -distance], [0,              0, 0]) ); 
                group.add( new Text3D( "+y", h1, [2, 2, 5], [0,   distance, 0], [ Math.PI * 0.5, 0, 0]) ); 
                group.add( new Text3D( "-y", h1, [2, 2, 5], [0,  -distance, 0], [-Math.PI * 0.5, 0, 0]) ); 
                group.name = "ORIGINS";
            
                resolve(group);  //  return group;
                
                function Text3D(text, style, scale, position, rotation){
                    var geometry = new THREE.TextGeometry( text, style );
                    var mesh = new THREE.Mesh(geometry, material );
                    geometry.computeBoundingBox();
                    var width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;
                    mesh.scale.fromArray( scale ); 
                    mesh.geometry.center();
                    mesh.position.fromArray( position );
                    mesh.rotation.fromArray( rotation );
                    return mesh;
                }
    
            });
    
        });
    
        promise;
        return group;
    }

</script>

</body>
</html>
